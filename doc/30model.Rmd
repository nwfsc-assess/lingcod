# Model

## Previous assessments and reviews

### History of modeling approaches

There have been nine assessments of `r spp` that
covered all or part of the U.S. West Coast since 1986.
Adams [-@pfmclingcod1986] conducted a yield per recruit analysis.
Jagielo [-@jagielo1994assessment] conducted an age-structured assessment for the portion of the resource
between Cape Falcon in Northern Oregon to 49\textdegree 00\textquotesingle N latitude
(off of southwest Vancouver Island in British Columbia - \gls{psmfc} areas 3A, 3B, and 3C, including Canada),
using Stock Synthesis [@methot_stock_2013].
Data included trawl and recreational catch from 1979-1993
with equilibrium catch before then,
\gls{s-tri} and trawl \gls{cpue} indices, and
length- and age-composition data.
The final spawning output was estimated to be about
20\% of pristine levels, and
catch recommendations ranged between 2500 and 3000 mt
based on fishing mortality levels of 40\% and 20\%.
The 1997 assessment [@jagielo1997assessment] expanded the area
south to Cape Blanco (42\textdegree 50\textquotesingle N latitude) and
retained the northern boundary of 49\textdegree 00\textquotesingle N latitude
using a Stock Synthesis model.
Estimated fraction unfished was below 0.10 for 1997.
In 1999, Adams et al. [-@pfmclingcod1999] conducted a length-based, age-structured population model
implemented in \gls{admb} [@fournier1996] for
the southern area, Eureka, Monterey, and Conception \gls{inpfc} areas,
which had not yet been assessed.
Jagielo et al. [-@jagielo2000assessment] fit data to age structured models in \gls{admb}
for two areas of the U.S.,
U.S. Vancouver-Columbia (no longer including Canadian waters) and
Eureka, Monterey, and Conception \gls{inpfc} areas.
Jagielo et al. [-@pfmclingcod2003] conducted age structured assessments
for the two areas using Coleraine.
In 2005, Jagielo et al. [-@pfmclingcod2005] switched back to
using Stock Synthesis, which was then at version 2 of the code base.
They found that the northern stock had recovered substantially
from a low point in the 1990s and was at 0.87 fraction unfished,
while the southern area had not recovered as well and was at 0.24 fraction unfished,
with a 0.64 coastwide fraction unfished.

The 2009 stock assessment, which used Stock Synthesis 2,
divided the northern (Washington and Oregon) and southern (California) stocks
by state line [@hamel2009lingcod].
The northern and southern models were made as equivalent as possible
by keeping fixed and estimated parameters largely the same for the two assessments.
Natural mortality was fixed at 0.18 for females and 0.32 for males in both assessments,
while stock-recruitment steepness was fixed at 0.8.
All of the age data were removed from the model prior to fitting the data because of
issues with outliers and possible aging bias.
The point estimate for fraction unfished at the start of 2009 was
0.619 for the northern area and 0.737 for the southern area,
indicating the stock was recovered.
The axis of uncertainty for the decision table provided to managers was
natural mortality for the northern area,
with the base model $M$ = 0.18 for females and 0.32 for males.
The 'Low M' alternative used $M$ = 0.16 and $M$ = 0.285 for females and males respectively,
and the 'High M' alternative used $M$ = 0.20 and 0.355.
The axis of uncertainty for the southern area
for the high alternative was the inclusion of age data and
for the low alternative was the exclusion of the dockside recreational \gls{cpue} index.

The 2017 assessment [@haltuch2019lingcod] was conducted using Stock Synthesis and
matched the spatial structure used for 2009 [@hamel2009lingcod] but made numerous changes,
including

- expansion of the time period of the assessments back to 1889,
- separation of commercial fleets into TW and FG,
- separation of state-specific recreational fleets
- updating of numerous existing data sources
- addition of numerous fishery-dependent \gls{cpue} indices and the \gls{s-hkl} index
- updated prior on natural mortality
- updated biology parameters for maturity and length-weight relationships
- updated ageing uncertainty
- different treatment of some age data as marginal versus conditioned on length

The estimated scales of the populations were sensitive to the inclusion of age data,
nevertheless, estimates of status remained the same with or without the age data.
Specifically,
the northern stock was estimated to be
above 40\% of estimated unfished spawning biomass and
the southern stock was estimated to be
below the target reference point at 32.1\% of unfished spawning biomass.

In 2019 a catch-only projection was conducted in which observed catches for the
years 2017 and 2018 were used in the forecast calculations, along with
expected catches for 2019 and 2020, to provided updated catch limits for management.

### Most recent STAR panel and SSC recommendations{#STAR}

```{r render-STARpanelRecs, results = "asis"}
sa4ss::read_child(file.path("STARpanelRecs.Rmd"))
```

### Response to Groundfish Subcommittee recommendations



## Model structure and assumptions

```{r render-model-changes, results = "asis"}
sa4ss::read_child("model-changes.Rmd")
```

### General model specifications

```{r render-model-specification, results = "asis"}
sa4ss::read_child("model-specifications.Rmd")
```
```{r render-model-selectivity, results = "asis"}
sa4ss::read_child("model-selectivity.Rmd")
```

### Model parameters {#sec-model-parameters}

```{r render-model-parameters, results = "asis"}
sa4ss::read_child("model-parameters.Rmd")
```

### Base model selection {#sec-model-selection}

```{r render-model-selection, results = "asis"}
sa4ss::read_child("model-selection.Rmd")
```

### Base model results

```{r render-model-results, results = "asis"}
sa4ss::read_child("model-results.Rmd")
```

### Model Diagnostics

#### Convergence

```{r render-model-jitter, results = "asis"}
sa4ss::read_child(file.path(paste0(params$model, "_jitter_0.05"), "model-results-jitter.md"))
```

#### Sensitivity Analyses

```{r render-model-sensitivities, results = "asis"}
sa4ss::read_child("model-sensitivities.Rmd")
```

#### Likelihood Profiles

```{r render-model-profile, results = "asis"}
sa4ss::read_child("model-profile.Rmd")
```

#### Retrospective Analysis

A five-year retrospective analysis was conducted by successively removing years of data
starting with the most recent year.
For the removal of the most recent year of data there were no changes to the model
trajectory or estimates of fraction unfished
(Figures \@ref(fig:RetroSsb) and \@ref(fig:RetroFractionunfished)).
```{asis, opts.label = "north"}
Peeling off more than one year of data led to a retrospective pattern with respect
to the estimated scale of the population but not current status.
```
```{asis, opts.label = "south"}
Removing five years of data led to a different historical time series for the stock,
one that indicated much higher productivity.
Regardless, the estimate of the current spawning stock biomass remained largely
consistent with the estimates from the base model.
```
Given time constraints, each of these models were not tuned, i.e.,
data weighting was not performed in an iterative fashion and bias adjustment
was not conducted, which could impact the model results.

### Evaluation of uncertainty

<!-- text below poached from Dover https://github.com/chantelwetzel-noaa/dover_sole_2021/ -->
The model estimated uncertainty around the `r model$endyr+1` spawning biomass 
was $\sigma$ = `r round(as.numeric(model$Pstar_sigma),2)` and the uncertainty around 
the OFL was $\sigma$ = `r round(as.numeric(model$OFL_sigma), 2)`. This is an 
underestimate of overall uncertainty because there is no explicit incorporation 
of model structural uncertainty.

### Comparison of north and south models

```{r render-model-compareareas, results = "asis"}
sa4ss::read_child("model-north-vs-south.Rmd")
```
